<form class="{{cssClass}} {{actor.type}} flexcol" autocomplete="off">

    <button type="button" class="getActor" style="position:absolute;top:0px;left:100px;">log</button>

    <nav class="sheet-tabs tabs tabs-bookmark" data-group="primary">
        <a class="item" data-tab="base">
            <span>Azioni</span>
        </a>
        <a class="item" data-tab="description">
            <span>Descrizione</span>
        </a>
        <a class="item" data-tab="skills">
            <span>Abilità</span>
        </a>
    </nav>

    <section class="sheet-body">
        <div class="tab">
            <div class="header">
                <img src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
                <div class="header-body">
                    <div class="head">
                        <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'FU.Sheet.Name'}}" class="name"/>

                        <div class="data-group">
                            <div class="form-group">
                                <label>Liv</label>
                                <input type="number" name="system.level.value" value="{{system.level.value}}"/>
                            </div>
                            <select name="system.species.value">
                                {{selectOptions species selected=system.species.value localize=true}}
                            </select>
                        </div>
                    </div>

                    <div class="desc">
                        <label>Tratti:</label>
                        <input type="text" name="system.traits" value="{{system.traits}}"/>
                    </div>

                    <div class="affinities">
                        <button type="button" class="js_btnAffinity" data-affinity="physical">
                            <div class="icon icon-physical {{#unless system.affinity.physical}}disabled{{/unless}}"></div>
                            {{#if system.affinity.physical}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.physical)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="air">
                            <div class="icon icon-air {{#unless system.affinity.air}}disabled{{/unless}}"></div>
                            {{#if system.affinity.air}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.air)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="bolt">
                            <div class="icon icon-bolt {{#unless system.affinity.bolt}}disabled{{/unless}}"></div>
                            {{#if system.affinity.bolt}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.bolt)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="dark">
                            <div class="icon icon-dark {{#unless system.affinity.dark}}disabled{{/unless}}"></div>
                            {{#if system.affinity.dark}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.dark)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="earth">
                            <div class="icon icon-earth {{#unless system.affinity.earth}}disabled{{/unless}}"></div>
                            {{#if system.affinity.earth}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.earth)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="fire">
                            <div class="icon icon-fire {{#unless system.affinity.fire}}disabled{{/unless}}"></div>
                            {{#if system.affinity.fire}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.fire)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="ice">
                            <div class="icon icon-ice {{#unless system.affinity.ice}}disabled{{/unless}}"></div>
                            {{#if system.affinity.ice}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.ice)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="light">
                            <div class="icon icon-light {{#unless system.affinity.light}}disabled{{/unless}}"></div>
                            {{#if system.affinity.light}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.light)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="poison">
                            <div class="icon icon-poison {{#unless system.affinity.poison}}disabled{{/unless}}"></div>
                            {{#if system.affinity.poison}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.poison)}}</span>
                            {{/if}}
                        </button>
                    </div>
                </div>
            </div>

            <div class="attributes-container">
                <div class="attr">
                    <label>DES</label>
                    <select name="system.resources.attributes.dex.value">
                        <option value="6" {{#if (eq system.resources.attributes.dex.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.dex.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.dex.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.dex.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>
                <div class="attr">
                    <label>INT</label>
                    <select name="system.resources.attributes.ins.value">
                        <option value="6" {{#if (eq system.resources.attributes.ins.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.ins.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.ins.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.ins.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>
                <div class="attr">
                    <label>VIG</label>
                    <select name="system.resources.attributes.mig.value">
                        <option value="6" {{#if (eq system.resources.attributes.mig.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.mig.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.mig.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.mig.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>
                <div class="attr">
                    <label>VOL</label>
                    <select name="system.resources.attributes.wlp.value">
                        <option value="6" {{#if (eq system.resources.attributes.wlp.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.wlp.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.wlp.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.wlp.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>

                {{#unless (eq system.resources.up.max 0)}}
                    <div class="attr">
                        <label>PU</label>
                        <input type="number" min="0" max="{{system.resources.up.max}}" name="system.resources.up.current" value="{{system.resources.up.current}}">
                        {{#unless (eq system.resources.up.max 0)}}
                            <label>/ {{system.resources.up.max}}</label>
                        {{/unless}}
                    </div>
                {{/unless}}
            </div>

            <div class="attributes-container">
                <div class="attr hp">
                    <label>PV</label>
                    <div class="info">
                        {{system.resources.hp.max}}
                        <span>◆</span>
                        {{system.resources.hp.crisis}}
                    </div>
                </div>

                <div class="attr mp">
                    <label>PM</label>
                    <div class="info">
                        {{system.resources.mp.max}}
                    </div>
                </div>
            </div>
            
            <div class="attributes-container params">
                <div class="attr">
                    <label>
                        Iniziativa: {{system.resources.params.init.bonus}}
                    </label>
                </div>

                <div class="attr">
                    <label>
                        Difesa: {{system.resources.params.def.bonus}}
                    </label>
                </div>

                <div class="attr">
                    <label>
                        Difesa Magica: {{system.resources.params.mdef.bonus}}
                    </label>
                </div>
            </div>
            
            <div class="tab base" data-group="primary" data-tab="base">
                <div class="content-collapse open attack">
                    <div class="title">
                        Attacchi base
                        <button type="button" class="js_addElementToList" data-target="system.baseAttacks">
                            <i class="fa fa-plus"></i>
                        </button>
                        {{!-- <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button> --}}
                    </div>
                    <div class="collapse">
                        <ul class="list list-attacks">
                            {{#each system.baseAttacks as |attack indexAttack|}}
                                <li>
                                    <button type="button" class="btn-del js_removeElementToList" data-id="{{indexAttack}}" data-target="system.baseAttacks">
                                        <i class="fa fa-remove"></i>
                                    </button>

                                    <div class="flexrow flex-head">
                                        <input type="text" name="system.baseAttacks.{{indexAttack}}.name" value="{{attack.name}}">
                                        <select name="system.baseAttacks.{{indexAttack}}.range">
                                            {{selectOptions ../WeaponRanges selected=attack.range localize=true}}
                                        </select>
                                    </div>

                                    <div class="flexrow flex-precision">
                                        <label>【Test di Precisione】</label>
                                        <select name="system.baseAttacks.{{indexAttack}}.precisionAttr.primary.value">
                                            {{selectOptions ../attributes selected=attack.precisionAttr.primary.value localize=true}}
                                        </select>
                                        <span>+</span>
                                        <select name="system.baseAttacks.{{indexAttack}}.precisionAttr.secondary.value">
                                            {{selectOptions ../attributes selected=attack.precisionAttr.secondary.value localize=true}}
                                        </select>
                                        <label>Modificatore:</label>
                                        <input type="number" name="system.baseAttacks.{{indexAttack}}.precisionBonus" value="{{attack.precisionBonus}}">
                                    </div>

                                    <div class="flexrow flex-damage">
                                        <label>【Calcolo dei Danni】</label>
                                        <span>TM +</span>
                                        <input type="number" name="system.baseAttacks.{{indexAttack}}.damage.value" value="{{attack.damage.value}}">
                                        <label>Tipo:</label>
                                        <select name="system.baseAttacks.{{indexAttack}}.damage.type.value">
                                            {{selectOptions ../DamageTypes selected=attack.damage.type.value localize=true}}
                                        </select>
                                    </div>

                                    {{editor (concatPath '../enrichedHtml.attacksDesc.' indexAttack) target=(concatPath 'system.baseAttacks.' indexAttack '.description') engine="prosemirror" rollData=rollData button=false owner=owner editable=editable }}
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>

                <div class="content-collapse open spell">
                    <div class="title">
                        Incantesimi
                        {{#if @root.editable}}
                            <button type="button" class="js_createItem" data-type="spell">
                                <i class="fa fa-plus"></i>
                            </button>
                        {{/if}}
                        {{!-- <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button> --}}
                    </div>
                    <div class="collapse">
                        <ul class="list list-spells">
                            {{#each spells}}
                                <li>
                                    <div class="btn-container">
                                        {{#if @root.editable}}
                                            <button type="button" class="js_deleteItem" data-itemid="{{this._id}}">
                                                <i class="fa fa-trash m-0"></i>
                                            </button>

                                            <button type="button" class="js_editItem" data-itemid="{{this._id}}">
                                                <i class="fa fa-pencil m-0"></i>
                                            </button>
                                        {{/if}}
                                    </div>
                                    <div class="item-box">
                                        {{#if @root.editable}}
                                            <button type="button" class="js_showItemInChat" data-itemid="{{this._id}}">
                                                <i class="fa fa-comment m-0"></i>
                                            </button>
                                            <button type="button" class="name js_rollSpell" data-itemid="{{this._id}}">
                                                {{this.name}}
                                                {{#if this.system.isOffensive.value}}
                                                    <div class="icon icon-offensive"></div>
                                                {{/if}}
                                            </button>
                                        {{else}}
                                            <label>
                                                {{this.name}}
                                                {{#if this.system.isOffensive.value}}
                                                    <div class="icon icon-offensive"></div>
                                                {{/if}}
                                            </label>
                                        {{/if}}
                                        <p>
                                            <strong>
                                                【{{localize (concat 'FU.attributesAbbr.' this.system.attributes.primary.value)}} + {{localize (concat 'FU.attributesAbbr.' this.system.attributes.secondary.value)}}】
                                            </strong>
                                            <small class="ml-0">◆</small>
                                            <strong>
                                                {{#if this.system.MPCost.upTo}}
                                                    Fino a
                                                {{/if}}
                                                {{this.system.MPCost.value}} PM
                                                {{#gt this.system.target.number 1}}
                                                    x B
                                                {{/gt}}
                                            </strong>
                                            <small>◆</small>
                                            <strong>{{this.system.target.value}}</strong>
                                            <small>◆</small>
                                            <strong>{{localize (concat 'FU.SpellDurations.' this.system.duration.value)}}.</strong>
                                        </p>

                                        <div class="description">
                                            {{{this.system.description}}}
                                        </div>
                                        
                                        {{#if this.system.opportunity.value}}
                                            <div class="opportunity">
                                                <strong>Opportunità:</strong>
                                                {{{this.system.opportunityEffect}}}
                                            </div>
                                        {{/if}}
                                    </div>
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>

                <div class="content-collapse open other">
                    <div class="title">
                        Altre azioni
                        {{#if @root.editable}}
                            <button type="button" class="js_createItem" data-type="baseItem">
                                <i class="fa fa-plus"></i>
                            </button>
                        {{/if}}
                        {{!-- <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button> --}}
                    </div>
                    <div class="collapse">
                        <ul class="list list-other-actions">
                            {{#each baseItems as |action indexAction|}}
                                {{#if (not action.system.rule)}}
                                    <li>
                                        <div class="btn-container">
                                            {{#if @root.editable}}
                                                <button type="button" class="js_deleteItem" data-itemid="{{action._id}}">
                                                    <i class="fa fa-trash m-0"></i>
                                                </button>

                                                <button type="button" class="js_editItem" data-itemid="{{action._id}}">
                                                    <i class="fa fa-pencil m-0"></i>
                                                </button>
                                            {{/if}}
                                        </div>
                                        <div class="item-box">
                                            {{#if @root.editable}}
                                                <button type="button" class="name js_showItemInChat" data-tooltip="Mostra in chat" data-itemid="{{action._id}}">
                                                    {{action.name}}
                                                </button>
                                            {{else}}
                                                <label>{{action.name}}</label>
                                            {{/if}}
                                            {{{action.system.description}}}
                                        </div>
                                    </li>
                                {{/if}}
                            {{/each}}
                        </ul>
                    </div>
                </div>

                <div class="content-collapse open rule">
                    <div class="title">
                        Regole speciali
                        {{#if @root.editable}}
                            <button type="button" class="js_createItem" data-type="baseItem" data-rule="true">
                                <i class="fa fa-plus"></i>
                            </button>
                        {{/if}}
                        {{!-- <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button> --}}
                    </div>
                    <div class="collapse">
                        <ul class="list list-special-rules">
                            {{#each baseItems as |rule indexRule|}}
                                {{#if rule.system.rule}}
                                    <li>
                                        <div class="btn-container">
                                            {{#if @root.editable}}
                                                <button type="button" class="js_deleteItem" data-itemid="{{rule._id}}">
                                                    <i class="fa fa-trash m-0"></i>
                                                </button>

                                                <button type="button" class="js_editItem" data-itemid="{{rule._id}}">
                                                    <i class="fa fa-pencil m-0"></i>
                                                </button>
                                            {{/if}}
                                        </div>
                                        <div class="item-box">
                                            {{#if @root.editable}}
                                                <button type="button" class="name js_showItemInChat" data-tooltip="Mostra in chat" data-itemid="{{rule._id}}">
                                                    {{rule.name}}
                                                </button>
                                            {{else}}
                                                <label>{{rule.name}}</label>
                                            {{/if}}
                                            {{{rule.system.description}}}
                                        </div>
                                    </li>
                                {{/if}}
                            {{/each}}
                        </ul>
                    </div>
                </div>

                {{#if (arrayLengthGt system.species.rules 0)}}
                    {{#each system.species.rules}}
                        <div class="title">{{this.name}}</div>
                        <ul class="list">
                            <li>
                                <div class="btn-container"></div>
                                <div class="item-box">
                                    {{{this.description}}}
                                </div>
                            </li>
                        </ul>
                    {{/each}}
                {{/if}}
            </div>
            
            <div class="tab desc" data-group="primary" data-tab="description">
                <div class="title">Descrizione</div>
                {{editor enrichedHtml.description target="system.description" engine="prosemirror" rollData=rollData button=false owner=owner editable=editable }}
            </div>

            <div class="tab skills" data-group="primary" data-tab="skills">
                <div class="form-group">
                    <label>Rango:</label>
                    <select name="system.rank.value">
                        {{selectOptions enemyRanks selected=system.rank.value localize=true}}
                    </select>
                    {{#unless (eq system.rank.value 'soldier')}}
                        <input type="number" name="system.rank.replacedSoldiers" value="{{system.rank.replacedSoldiers}}">
                    {{/unless}}
                </div>
                <div class="form-group">
                    <label>Cattivo:</label>
                    <select name="system.villain">
                        {{selectOptions villainTypes selected=system.villain localize=true}}
                    </select>
                </div>

                <div class="title">
                    Abilità
                    <span class="is-on-right">【{{system.skills.current}} / {{system.skills.max}}】</span>
                </div>
                {{#each flags.fabula.classFeatures}}
                    <div class="feature-box">
                        <div class="feature-head">
                            {{#if @root.editable}}
                                <button type="button" class="removeFeature" data-id="{{this._id}}">Rimuovi</button>
                            {{/if}}
                            
                            {{this.name}}

                            {{#if @root.editable}}
                                <button type="button" class="ml-auto freeFreature {{#if this.system.isFree}}active{{/if}}" data-id="{{this._id}}">Gratuita</button>
                            {{/if}}
                            
                            {{#gt this.system.level.max 1}}
                                <span>
                                    (<span>l</span>{{this.system.level.max}})
                                </span>
                            {{/gt}}

                            {{#if this.system.isLimited}}
                                <span>
                                    (<span class="font-yanone">LIMITATA</span>)
                                </span>
                            {{/if}}
                        </div>
                        <div class="feature-body">
                            {{{this.system.description}}}
                        </div>
                    </div>
                    {{#each this.flags.fabula.subItems}}
                        <div class="equip-box">
                            <div class="equip-head">
                                <img src="{{this.img}}" title="{{this.name}}" />
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Arma</th>
                                            <th>Precisione</th>
                                            <th>Danno</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>{{localize (concat 'FU.weaponCategories.' this.system.type)}}</td>
                                            <td>
                                                <strong>
                                                    【{{localize (concat 'FU.attributesAbbr.' this.system.precisionAttributes.primary.value)}}
                                                    + 
                                                    {{localize (concat 'FU.attributesAbbr.' this.system.precisionAttributes.secondary.value)}}】
                                                    {{#unless (eq this.system.precisionBonus 0)}}
                                                        {{#gt this.system.precisionBonus 0}}
                                                            +{{this.system.precisionBonus}}
                                                        {{else}}
                                                            {{this.system.precisionBonus}}
                                                        {{/gt}}
                                                    {{/unless}}
                                                </strong>
                                            </td>
                                            <td>
                                                <strong>
                                                    【TM
                                                    {{#gt_e this.system.damage.value 0}}
                                                        + {{this.system.damage.value}}】
                                                    {{else}}
                                                        - {{multiply this.system.damage.value -1}}】
                                                    {{/gt_e}}
                                                    {{localize (concat 'FU.DamageTypes.' this.system.damage.type.value)}}
                                                </strong>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="equip-body">
                                <div class="desc-container">
                                    {{#if this.system.needTwoHands}}
                                        Due mani
                                    {{else}}
                                        Una mano
                                    {{/if}}
                                    <span class="diamond-char">◆</span>
                                    {{localize (concat 'FU.WeaponRanges.' this.system.range)}}
                                </div>
                                <div class="desc-container">
                                    {{{this.system.description}}}
                                </div>
                            </div>
                        </div>
                    {{/each}}
                {{/each}}
            </div>
        </div>
    </section>
</form>