<form class="{{cssClass}} {{actor.type}} flexcol" autocomplete="off">

    <button type="button" class="getActor" style="position:absolute;top:0px;left:100px;">log</button>

    <nav class="sheet-tabs tabs tabs-bookmark" data-group="primary">
        <a class="item" data-tab="base">
            <span>Azioni</span>
        </a>
        <a class="item" data-tab="description">
            <span>Descrizione</span>
        </a>
        <a class="item" data-tab="skills">
            <span>Abilità</span>
        </a>
    </nav>

    <section class="sheet-body">
        <div class="tab">
            <div class="header">
                <img src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
                <div class="header-body">
                    <div class="head">
                        <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'FU.Sheet.Name'}}" class="name"/>

                        <div class="data-group">
                            <div class="form-group">
                                <label>Liv</label>
                                <input type="number" name="system.level.value" value="{{system.level.value}}"/>
                            </div>
                            <select name="system.species">
                                {{selectOptions species selected=system.species localize=true}}
                            </select>
                        </div>
                    </div>

                    <div class="desc">
                        <label>Tratti:</label>
                        <input type="text" name="system.traits" value="{{system.traits}}"/>
                    </div>

                    <div class="affinities">
                        <button type="button" class="js_btnAffinity" data-affinity="physical">
                            <div class="icon icon-physical {{#unless system.affinity.physical}}disabled{{/unless}}"></div>
                            {{#if system.affinity.physical}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.physical)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="air">
                            <div class="icon icon-air {{#unless system.affinity.air}}disabled{{/unless}}"></div>
                            {{#if system.affinity.air}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.air)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="bolt">
                            <div class="icon icon-bolt {{#unless system.affinity.bolt}}disabled{{/unless}}"></div>
                            {{#if system.affinity.bolt}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.bolt)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="dark">
                            <div class="icon icon-dark {{#unless system.affinity.dark}}disabled{{/unless}}"></div>
                            {{#if system.affinity.dark}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.dark)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="earth">
                            <div class="icon icon-earth {{#unless system.affinity.earth}}disabled{{/unless}}"></div>
                            {{#if system.affinity.earth}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.earth)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="fire">
                            <div class="icon icon-fire {{#unless system.affinity.fire}}disabled{{/unless}}"></div>
                            {{#if system.affinity.fire}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.fire)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="ice">
                            <div class="icon icon-ice {{#unless system.affinity.ice}}disabled{{/unless}}"></div>
                            {{#if system.affinity.ice}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.ice)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="light">
                            <div class="icon icon-light {{#unless system.affinity.light}}disabled{{/unless}}"></div>
                            {{#if system.affinity.light}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.light)}}</span>
                            {{/if}}
                        </button>
                        <button type="button" class="js_btnAffinity" data-affinity="poison">
                            <div class="icon icon-poison {{#unless system.affinity.poison}}disabled{{/unless}}"></div>
                            {{#if system.affinity.poison}}
                                <span>{{localize (concat 'FU.affinityAbbr.' system.affinity.poison)}}</span>
                            {{/if}}
                        </button>
                    </div>
                </div>
            </div>

            <div class="attributes-container">
                <div class="attr">
                    <label>DES</label>
                    <select name="system.resources.attributes.dex.value">
                        <option value="6" {{#if (eq system.resources.attributes.dex.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.dex.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.dex.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.dex.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>
                <div class="attr">
                    <label>INT</label>
                    <select name="system.resources.attributes.ins.value">
                        <option value="6" {{#if (eq system.resources.attributes.ins.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.ins.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.ins.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.ins.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>
                <div class="attr">
                    <label>VIG</label>
                    <select name="system.resources.attributes.mig.value">
                        <option value="6" {{#if (eq system.resources.attributes.mig.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.mig.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.mig.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.mig.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>
                <div class="attr">
                    <label>VOL</label>
                    <select name="system.resources.attributes.wlp.value">
                        <option value="6" {{#if (eq system.resources.attributes.wlp.value 6)}}selected{{/if}}>d6</option>
                        <option value="8" {{#if (eq system.resources.attributes.wlp.value 8)}}selected{{/if}}>d8</option>
                        <option value="10" {{#if (eq system.resources.attributes.wlp.value 10)}}selected{{/if}}>d10</option>
                        <option value="12" {{#if (eq system.resources.attributes.wlp.value 12)}}selected{{/if}}>d12</option>
                    </select>
                </div>

                <div class="attr hp">
                    <label>PV</label>
                    <div class="info">
                        {{system.resources.hp.max}}
                        <span>◆</span>
                        {{system.resources.hp.crisis}}
                    </div>
                </div>

                <div class="attr mp">
                    <label>PM</label>
                    <div class="info">
                        {{system.resources.mp.max}}
                    </div>
                </div>
            </div>
            
            <div class="attributes-container params">
                <div class="attr">
                    <label>
                        Iniziativa: {{system.resources.params.init.bonus}}
                    </label>
                </div>

                <div class="attr">
                    <label>
                        Difesa: {{system.resources.params.def.bonus}}
                    </label>
                </div>

                <div class="attr">
                    <label>
                        Difesa Magica: {{system.resources.params.mdef.bonus}}
                    </label>
                </div>

                <div class="attr">
                    <label>
                        Punti Ultima: {{system.resources.up}}
                    </label>
                </div>
            </div>
            
            <div class="tab base" data-group="primary" data-tab="base">
                <div class="content-collapse attack">
                    <div class="title">
                        Attacchi base
                        <button type="button" class="js_addElementToList" data-target="system.baseAttacks">
                            <i class="fa fa-plus"></i>
                        </button>
                        <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button>
                    </div>
                    <div class="collapse">
                        <ul class="list list-attacks">
                            {{#each system.baseAttacks as |attack indexAttack|}}
                                <li>
                                    <button type="button" class="btn-del js_removeElementToList" data-id="{{indexAttack}}" data-target="system.baseAttacks">
                                        <div class="fa fa-remove"></div>
                                    </button>

                                    <div class="flexrow flex-head">
                                        <input type="text" name="system.baseAttacks.{{indexAttack}}.name" value="{{attack.name}}">
                                        <select name="system.baseAttacks.{{indexAttack}}.range">
                                            {{selectOptions ../WeaponRanges selected=attack.range localize=true}}
                                        </select>
                                    </div>

                                    <div class="flexrow flex-precision">
                                        <label>【Test di Precisione】</label>
                                        <select name="system.baseAttacks.{{indexAttack}}.precisionAttr.primary.value">
                                            {{selectOptions ../attributes selected=attack.precisionAttr.primary.value localize=true}}
                                        </select>
                                        <span>+</span>
                                        <select name="system.baseAttacks.{{indexAttack}}.precisionAttr.secondary.value">
                                            {{selectOptions ../attributes selected=attack.precisionAttr.secondary.value localize=true}}
                                        </select>
                                        <label>Modificatore:</label>
                                        <input type="number" name="system.baseAttacks.{{indexAttack}}.precisionBonus" value="{{attack.precisionBonus}}">
                                    </div>

                                    <div class="flexrow flex-damage">
                                        <label>【Calcolo dei Danni】</label>
                                        <span>TM +</span>
                                        <input type="number" name="system.baseAttacks.{{indexAttack}}.damage.value" value="{{attack.damage.value}}">
                                        <label>Tipo:</label>
                                        <select name="system.baseAttacks.{{indexAttack}}.damage.type.value">
                                            {{selectOptions ../DamageTypes selected=attack.damage.type.value localize=true}}
                                        </select>
                                    </div>

                                    {{editor (concatPath '../enrichedHtml.actionDescription.' indexAttack) target=(concatPath 'system.baseAttacks.' indexAttack '.description') engine="prosemirror" rollData=rollData button=false owner=owner editable=editable }}
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>

                <div class="content-collapse spell">
                    <div class="title">
                        Incantesimi
                        <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button>
                    </div>
                    <div class="collapse">
                        <ul class="list list-spells">
                            {{#each spells}}
                                <li>
                                    <strong>Nome:</strong> {{this.name}} 
                                    {{#if this.isOffensive.value}}v{{/if}} <br>

                                    <strong>PM:</strong> 
                                    {{#if this.system.MPCost.upTo}}
                                    Fino a
                                    {{/if}}
                                    {{this.system.MPCost.value}}
                                    {{#gt this.system.target.number 1}}
                                    x B
                                    {{/gt}}
                                    <br>

                                    <strong>Test di Magia:</strong> 
                                    【{{localize (concat 'FU.attributesAbbr.' this.system.attributes.primary.value)}} + {{localize (concat 'FU.attributesAbbr.' this.system.attributes.secondary.value)}}】

                                    {{#if this.system.damage.hasDamage}}
                                    <strong>Danno:</strong> {{this.system.damage.value}} {{localize (concat 'FU.DamageTypes.' this.system.damage.type)}} <br>
                                    {{/if}}

                                    <strong>Bersaglio:</strong> {{this.system.target.value}} <br>

                                    <strong>Durata:</strong> {{localize (concat 'FU.SpellDurations.' this.system.duration.value)}} <br>

                                    {{{this.system.description}}}
                                    
                                    {{#if this.system.opportunity.value}}
                                        <strong>Opportunità:</strong>
                                        {{{this.system.opportunityEffect}}}
                                    {{/if}}
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>

                <div class="content-collapse other">
                    <div class="title">
                        Altre azioni
                        <button type="button" class="js_addElementToList" data-target="system.otherActions">
                            <i class="fa fa-plus"></i>
                        </button>
                        <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button>
                    </div>
                    <div class="collapse">
                        <ul class="list list-other-actions">
                            {{#each system.otherActions as |action indexAction|}}
                                <li>
                                    <button type="button" class="btn-del js_removeElementToList" data-id="{{indexAction}}" data-target="system.otherActions">
                                        <div class="fa fa-remove"></div>
                                    </button>
                                    
                                    <div class="flexrow flex-head">
                                        <input type="text" name="system.otherActions.{{indexAction}}.name" value="{{action.name}}">
                                    </div>

                                    {{editor (concatPath '../enrichedHtml.actionDescription.' indexAction) target=(concatPath 'system.otherActions.' indexAction '.description') engine="prosemirror" rollData=rollData button=false owner=owner editable=editable }}
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>

                <div class="content-collapse rule">
                    <div class="title">
                        Regole speciali
                        <button type="button" class="js_addElementToList" data-target="system.specialRules">
                            <i class="fa fa-plus"></i>
                        </button>
                        <button type="button" class="js_toggleCollapse" aria-expanded="false">
                            <i class="fa fa-angle-down"></i>
                        </button>
                    </div>
                    <div class="collapse">
                        <ul class="list list-special-rules">
                            {{#each system.specialRules as |rule indexRule|}}
                                <li>
                                    <button type="button" class="btn-del js_removeElementToList" data-id="{{indexRule}}" data-target="system.specialRules">
                                        <div class="fa fa-remove"></div>
                                    </button>
                                    
                                    <div class="flexrow flex-head">
                                        <input type="text" name="system.specialRules.{{indexRule}}.name" value="{{rule.name}}">
                                    </div>

                                    {{editor (concatPath '../enrichedHtml.actionDescription.' indexRule) target=(concatPath 'system.specialRules.' indexRule '.description') engine="prosemirror" rollData=rollData button=false owner=owner editable=editable }}
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="tab desc" data-group="primary" data-tab="description">
                <div class="title">Descrizione</div>
                {{editor enrichedHtml.description target="system.description" engine="prosemirror" rollData=rollData button=false owner=owner editable=editable }}
            </div>

            <div class="tab skills" data-group="primary" data-tab="skills">
                <div class="form-group">
                    <label>Rango:</label>
                    <select name="system.rank.value">
                        {{selectOptions enemyRanks selected=system.rank.value localize=true}}
                    </select>
                    {{#unless (eq system.rank.value 'soldier')}}
                        <input type="number" name="system.rank.replacedSoldiers" value="{{system.rank.replacedSoldiers}}">
                    {{/unless}}
                </div>
                <div class="form-group">
                    <label>Cattivo:</label>
                    <select name="system.villain">
                        {{selectOptions villainTypes selected=system.villain localize=true}}
                    </select>
                </div>

                <div class="title">
                    Abilità
                    <span class="is-on-right">【{{system.skills.current}} / {{system.skills.max}}】</span>
                </div>
                {{#each flags.fabula.classFeatures}}
                    <div class="feature-box">
                        <div class="feature-head">
                            {{#if @root.editable}}
                                <button type="button" class="removeFeature" data-id="{{this._id}}">Rimuovi</button>
                            {{/if}}
                            
                            {{this.name}}
                            {{#gt this.system.level.max 1}}
                                <span>
                                    (<span>l</span>{{this.system.level.max}})
                                </span>
                            {{/gt}}
                        </div>
                        <div class="feature-body">
                            {{{this.system.description}}}
                        </div>
                    </div>
                    {{#each this.flags.fabula.subItems}}
                        <div class="equip-box">
                            <div class="equip-head">
                                <img src="{{this.img}}" title="{{this.name}}" />
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Arma</th>
                                            <th>Precisione</th>
                                            <th>Danno</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>{{localize (concat 'FU.weaponCategories.' this.system.type)}}</td>
                                            <td>
                                                <strong>
                                                    【{{localize (concat 'FU.attributesAbbr.' this.system.precisionAttributes.primary.value)}}
                                                    + 
                                                    {{localize (concat 'FU.attributesAbbr.' this.system.precisionAttributes.secondary.value)}}】
                                                    {{#unless (eq this.system.precisionBonus 0)}}
                                                        {{#gt this.system.precisionBonus 0}}
                                                            +{{this.system.precisionBonus}}
                                                        {{else}}
                                                            {{this.system.precisionBonus}}
                                                        {{/gt}}
                                                    {{/unless}}
                                                </strong>
                                            </td>
                                            <td>
                                                <strong>
                                                    【TM
                                                    {{#gt_e this.system.damage.value 0}}
                                                        + {{this.system.damage.value}}】
                                                    {{else}}
                                                        - {{multiply this.system.damage.value -1}}】
                                                    {{/gt_e}}
                                                    {{localize (concat 'FU.DamageTypes.' this.system.damage.type.value)}}
                                                </strong>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="equip-body">
                                <div class="desc-container">
                                    {{#if this.system.needTwoHands}}
                                        Due mani
                                    {{else}}
                                        Una mano
                                    {{/if}}
                                    <span class="diamond-char">◆</span>
                                    {{localize (concat 'FU.WeaponRanges.' this.system.range)}}
                                </div>
                                <div class="desc-container">
                                    {{{this.system.description}}}
                                </div>
                            </div>
                        </div>
                    {{/each}}
                {{/each}}
            </div>
        </div>
    </section>
</form>